# DEVELOPER.md

Developer guide for divider. This document reflects the current structure, tooling, and day‑to‑day workflow.

## Prerequisites / Setup

- Node.js: >= 18 (recommend latest LTS)
- Package manager: pnpm
- Recommended: enable pnpm via corepack

Steps:

- `corepack enable`
- Install dependencies after cloning

```sh
git clone https://github.com/nyaomaru/divider.git
cd divider
pnpm install
```

Optional (with mise):

- Install mise (choose one):
  - macOS: `brew install mise`
  - Linux: `curl https://mise.run | sh`
  - Windows (PowerShell): `irm https://mise.run | iex`
- Install pinned toolchain from `mise.toml`: `mise install`
- Run pinned tasks via `mise run <task>`
- One‑shot QA: `mise run qa` (lint + test + build)

Useful tasks defined in `mise.toml`:

- `mise run lint|build|test|test_unit|test_performance|test_integration`
- `mise run qa` (lint → test → build)
- Deno: `mise run deno_check|deno_test|deno_lint|deno_fmt|deno_fmt_check|deno_publish`
- Bun smoke test: `mise run bun_test`

## Project Structure

- `src/`: Library sources (TypeScript)
  - `src/core/`: Core logic
  - `src/utils/`: Reusable helpers
  - `src/presets/`: Common use‑case presets
  - `src/types/`: Shared types
  - `src/constants/`: Constants
  - Entry points: `src/index.ts` (Node/NPM) and `src/mod.ts` (JSR)
- `tests/`: Jest tests
  - Unit: `tests/utils/`, `tests/core/`, `tests/presets/`
  - Integration: `tests/integration/`
  - Performance: `tests/performance/`
- `tests-deno/`, `tests-bun/`: Deno/Bun specific tests
- `dist/`: Build artifacts generated by `tsup` (do not edit by hand)
- Path alias: `@/…` → `src/` (see `tsconfig.json` / `deno.json`)

## Development Commands

- Install deps: `pnpm install`
- Lint: `pnpm lint` (ESLint + Prettier plugin; fix warnings/errors)
- Build: `pnpm build` (bundles with `tsup` to ESM/CJS and emits types)
- Test (all unit): `pnpm test` or `pnpm run test:unit`
- Test (performance): `pnpm run test:performance`
- Targeted run example: `pnpm test -- tests/utils/array.test.ts`
- Generate TypeDoc: `pnpm typedoc`

Recommended pre‑push gate: `pnpm lint && pnpm test && pnpm build`

## Coding Standards

- Language: TypeScript with `strict: true`
- Immutability: prefer `readonly` inputs; do not mutate parameters
- Naming/formatting:
  - Files: kebab‑case (e.g., `divider-first.ts`)
  - Types/interfaces: PascalCase
  - Functions: camelCase
  - Constants: UPPER_SNAKE_CASE when appropriate
- Formatting: Prettier 3 via ESLint (2‑space indent, single quotes, trailing commas)
- Complexity: cyclomatic complexity ≤ 7 (enforced by ESLint)
- Avoid magic numbers; extract to `src/constants/` when sensible
- JSDoc: add to public APIs (one‑line summary + `@param`/`@returns`)
- WHY comments: explain non‑obvious design/implementation choices briefly
- Prefer imports via `@/…` to keep paths stable

Reference configs:

- Lint: `eslint.config.js`
- TypeScript: `tsconfig.json`
- Build: `tsup.config.ts`
- Jest: `jest.config.cjs`, `jest.performance.config.cjs`

## Testing Strategy (Jest)

- Environment: Node; preset: `ts-jest`
- Layout/naming:
  - Unit tests under `tests/**.test.ts`
  - Performance tests under `tests/performance/**.performance.test.ts`
  - Integration tests under `tests/integration/` when needed
- Alias mapping: `@/` → `src/` via `moduleNameMapper`
- Coverage focus: normal, edge (empty strings/arrays), and error cases; include quoted/escaped and irregular separators

## Build & Distribution

- `tsup` outputs ESM/CJS bundles and `.d.ts` to `dist/`
- Do not edit `dist/` manually (generated artifacts)
- NPM distribution follows `package.json` `exports`
- JSR (Deno/Bun) distribution uses `deno.json` / `jsr.json` with `src/mod.ts`

## Deno / Bun / JSR Notes

- Deno import map: `deno.json` → `imports: { "@/": "./src/" }`
- Useful Deno tasks: `deno task check`, `deno task test`, `deno lint`, `deno fmt`
- JSR publish: `deno publish` from a tagged commit (CI supports OIDC publish)
- See `tests-bun/` and `tests-deno/` for Bun/Deno validations

## Commit / PR Policy

- Commits: Conventional Commits (`feat:`, `fix:`, `refactor:`, `test:`, `docs:`, `chore:`)
- PRs: include purpose/background, linked issue, and behavior changes; attach small examples when touching parsing
- Quality gate: pass `pnpm lint && pnpm test && pnpm build` locally
- Do not manually bump versions or edit `dist/`; releases are automated

## Security / Configuration Tips

- No secrets required; respect `.gitignore` and ESLint ignores (`dist/`, `docs/`)
- Prefer `@/…` imports for stability when moving files

## Typical Workflow

1. Implement: edit `src/**` (helpers in `src/utils/`, core in `src/core/`)
2. Add tests: mirror under `tests/**` (BDD style; AAA structure)
3. Lint: `pnpm lint`
4. Run tests: `pnpm test` (filter as needed)
5. Build: `pnpm build`

Additional docs: `README.md`, `CHANGELOG.md`, `CONTRIBUTING.md`, `CODE_OF_CONDUCT.md`

If anything is unclear, please open an Issue or PR to discuss.
